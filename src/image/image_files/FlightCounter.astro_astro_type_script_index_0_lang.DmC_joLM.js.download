import"./index.astro_astro_type_script_index_0_lang.UiX8fiQf.js";class c extends HTMLElement{counter;key;currentTimeout;currentFallbackInterval=30;previousDateTimeFromData;count=0;dateElement;#t;UPDATE_INTERVAL=20*60;FIXED_DELAY_IN_SECONDS=220*60;constructor(){super(),this.counter=this.querySelector("skydio-counter"),this.key=this.getAttribute("key"),this.dateElement=this.querySelector(".sfc__date"),this.date=new Date,this.init()}get date(){return this.#t}set date(i){this.#t=i,this.dateElement.innerText=this.formatDate(i)}init(){document.readyState==="complete"?this.updateToLatestData():window.addEventListener("load",()=>{this.updateToLatestData()}),setInterval(this.updateDateTime.bind(this),1e3)}formatDate(i){const t=new Date(i),e=a=>a.toString().padStart(2,"0");return"Time: "+[e(t.getHours()),e(t.getMinutes()),e(t.getSeconds())].join(":")+" Date: "+[t.getFullYear(),e(t.getMonth()+1),e(t.getDate())].join(".")}handleEvent(i){this.updateToLatestData()}setNextUpdate(i){this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.currentTimeout=setTimeout(this.updateToLatestData.bind(this),i*1e3)}updateToLatestData(){if(this.count+=1,this.count>10){clearTimeout(this.currentTimeout);return}fetch("/flight-counter/data").then(async i=>{const t=await i.json();let e=t.flightCount.previous;const a=new Date(t.flightCount.previousDateTime),r=new Date(new Date().getTime()-this.FIXED_DELAY_IN_SECONDS*1e3),n=Math.floor((r.getTime()-a.getTime())/1e3);if(this.previousDateTimeFromData=a,n>0&&(e+=Math.floor(n/t.flightCount.tickValues.delay*t.flightCount.tickValues.amount),e>t.flightCount.current&&(e=t.flightCount.current)),isNaN(e)||!e)return;this.counter.setAttribute("increase",t.flightCount.tickValues.amount),this.counter.setAttribute("interval",t.flightCount.tickValues.delay),this.counter.setAttribute("maxValue",t.flightCount.current),this.counter.setAttribute("number",e);const s=this.UPDATE_INTERVAL-n;this.currentFallbackInterval=s>0?30:Math.floor(this.currentFallbackInterval*1.5);const u=s<0?this.currentFallbackInterval:s+30;if(s<0)this.count++;else{const o=a.getTime()+n*1e3;this.date=new Date(o),this.count=0}this.setNextUpdate(u)}).catch(()=>{this.currentFallbackInterval*=1.5,this.setNextUpdate(this.currentFallbackInterval)})}updateDateTime(){this.date=new Date}}"customElements"in window&&customElements.define("skydio-flights-counter",c);
