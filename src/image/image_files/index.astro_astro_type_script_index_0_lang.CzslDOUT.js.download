import{h as i}from"./dom.2z_JnjJB.js";import"./eventManager.C0cYWzaI.js";import{i as e}from"./helpers.BkuxQz07.js";class n{_content;options;element;grouping;id;popup;loadingResources;doNotShow;contentAddedToPopup;constructor(s,t,o){this.options={smallPopup:t.layout==="small",track:!!t.track||t.track==="true",trackPopupCloseOnSessionBasis:!!t.trackPopupCloseOnSessionBasis||t.trackPopupCloseOnSessionBasis==="true",animation:t.animation,overlayOpacity:t.overlayOpacity??0,overlayBlur:t.overlayBlur??0,layout:t.layout,maxWidth:t.maxWidth,containerSize:t.containerSize,classes:t.classes,style:t.style,styles:t.styles,loadImmediately:t.loadImmediately===!0,contentUrl:t.contentUrl,onLoad:t.onLoad??(()=>!0),onClose:t.onClose??(()=>{}),grouping:t.grouping},this.grouping=this.options.grouping,this.element=o,this.id=s,this.initialize()}get close(){return this.popup?.querySelector("[data-popup-close]")}get content(){return this._content}set content(s){this._content=typeof s=="string"?i(s):s}initialize(){if(this.createPopupContainer(),this.options.track&&localStorage.getItem(`popup-${this.grouping}`)==="true"){this.doNotShow=!0;return}if(this.options.trackPopupCloseOnSessionBasis&&sessionStorage.getItem(`popup-${this.grouping}`)==="true"){this.doNotShow=!0;return}this.popup.classList.add("popup--v2","v2"),this.options.smallPopup&&this.popup.classList.add("popup--small"),this.options.style&&this.options.style.length>0&&this.popup.classList.add(`popup--${this.options.style}`),this.getContent().then(s=>{this.content=s,this.options.onLoad(this)}).then(()=>{this.options.loadImmediately&&this.show()})}createPopupContainer(){this.popup=this.createElements(),this.addListeners()}async getContent(){return this.element?this.element.outerHTML:(this.loadingResources=!0,fetch(this.options.contentUrl??`/popups/${this.id}/index.html`).then(s=>{if(this.loadingResources=!1,!s.ok)throw new Error("Network response was not ok");return s.text()}).catch(s=>(this.loadingResources=!1,console.error("Failed to load popup content:",s),"<div>Error loading content</div>")))}async show(){this.doNotShow||await this.loadPopupAndAddToDOM().then(()=>{this.options.smallPopup||document.body.classList.add("popup__body"),this.popup.classList.add("popup--visible"),setTimeout(()=>this.popup.classList.add("popup--anim"),200)})}async loadPopupAndAddToDOM(){document.body.append(this.popup),!this.contentAddedToPopup&&e(this.content)&&(this.popup.querySelector(".popup__inner").append(...this.content),this.contentAddedToPopup=!0)}createElements(){const s=[];this.options.animation&&s.push(`popup--anim-${this.options.animation}`),this.options.classes&&s.push(this.options.classes);const t=[];this.options.smallPopup||(t.push(`--popup-overlay-opacity: ${this.options.overlayOpacity}`),t.push(`--popup-overlay-blur: ${this.options.overlayBlur}px`)),this.options.smallPopup&&this.options.maxWidth&&t.push(`--popup-max-width: ${this.options.maxWidth}`),this.options.styles&&t.push(this.options.styles);const o=[];return this.options.containerSize&&!this.options.smallPopup&&o.push(`container--${this.options.containerSize}`),i(`<div class="popup">
      <div class="popup__overlay ${s.join(" ")}" style="${t.join("; ")}">
        <div class="popup__outer container ${o.join(" ")}">
          <div class="popup__wrap">
            <button class="popup__close" data-popup-close><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 31 31" width="31" height="31" fill="none"><path stroke="#000" d="m0 1 30 29M29 1 1 30"/></svg></button>
            <div class="popup__inner">
            </div>
          </div>
        </div>
      </div>
    </div>`)[0]}hide(){this.popup.classList.add("popup--anim-reverse"),this.popup.classList.remove("popup--anim"),setTimeout(()=>{this.popup.classList.remove("popup--visible"),this.popup.classList.remove("popup--anim-reverse"),document.body.classList.remove("popup__body"),document.body.removeChild(this.popup),this.options.onClose()},300),!this.options.trackPopupCloseOnSessionBasis&&this.options.track&&this.grouping&&localStorage.setItem(`popup-${this.grouping}`,"true"),this.options.trackPopupCloseOnSessionBasis&&this.grouping&&sessionStorage.setItem(`popup-${this.grouping}`,"true")}addListeners(){this.close.addEventListener("click",this.hide.bind(this))}}class a{openPopups=[];popupTypeOptions=new Map;constructor(){this.createPopupTypeOptions(),globalThis.EventManager.on("popup:open",s=>{const t=new n(s.detail.id,{...this.popupTypeOptions.get(s.detail.type)??{},...s.detail.options??{}},s.detail.element);this.openPopups.push(t)})}createPopupTypeOptions(){this.popupTypeOptions.set("FooterBanner",{loadImmediately:!0,animation:"slide",maxWidth:"100%",layout:"small"})}}globalThis._popupBase||(globalThis._popupBase=new a);
